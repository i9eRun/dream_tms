/*
 * File: app/view/tbas/tbas1010ViewController.js
 *
 * This file was generated by Sencha Architect version 4.3.7.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 7.9.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 7.9.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('dream.view.tbas.tbas1010ViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.tbas.tbas1010',

    onButtonClick_search_button: function(button, e, eOpts) {
        const type = this.lookupReference('type');
        const keyword = this.lookupReference('keyword');
        const store = this.lookupReference('list_grid').getStore();
        const grid1_store = this.lookupReference('chulpan_grid1').getStore();
        const grid2_store = this.lookupReference('chulpan_grid2').getStore();

        grid1_store.removeAll();
        grid2_store.removeAll();

        store.getProxy().setExtraParams({
            userCetCd: dream.util.Common.LOGIN_USER_CET_CD,
            type: type.getValue(),
            keyword: keyword.getValue()
        });

        store.load();


    },

    onButtonClick_chulpan_search_button: function(button, e, eOpts) {
        const popup = Ext.create('dream.view.tpop.tpop1003');
        const me = this;
        const chulpan_code = this.lookupReference('chulpan_code');
        const chulpan_name = this.lookupReference('chulpan_name');

        popup.on('selectUser', function(win, record) {
            chulpan_code.setValue(record.get('CUST_CD'));
            chulpan_name.setValue(record.get('CUST_NM'));
        });

        popup.show();
    },

    onButtonClick_chulpan_search_button2: function(button, e, eOpts) {
        const popup = Ext.create('dream.view.tpop.tpop1003');
        const me = this;
        const chulpan_code = this.lookupReference('chulpan_code2');
        const chulpan_name = this.lookupReference('chulpan_name2');

        popup.on('selectUser', function(win, record) {
            chulpan_code.setValue(record.get('CUST_CD'));
            chulpan_name.setValue(record.get('CUST_NM'));
        });

        popup.show();
    },

    onButtonClick_chulpan_delete_button: function(button, e, eOpts) {
        const list_grid = this.lookupReference('list_grid');
        const chulpan_grid1 = this.lookupReference('chulpan_grid1');

        if (list_grid.getSelection().length === 0) {
            Ext.Msg.alert('알림', '서점을 선택해주세요.');
            return;
        }

        if (chulpan_grid1.getSelection().length === 0) {
            Ext.Msg.alert('알림', '삭제할 출판사를 선택해주세요.');
            return;
        }

        const sujum_code = list_grid.getSelection()[0].get('sujumCd');
        const record = chulpan_grid1.getSelection()[0];
        const chulpan_code = record.get('chulpanCd');

        Ext.Msg.confirm('확인', '삭제하시겠습니까?', function(btn) {
            if (btn === 'yes') {
                Ext.Ajax.request({
                    url: dream.util.Common.BASE_URL + '/tbas/1010/chulpan-delete',
                    method: 'DELETE',
                    jsonData: {
                        userCetCd: dream.util.Common.LOGIN_USER_CET_CD,
                        sujumCd: sujum_code,
                        chulpanCd: chulpan_code
                    },
                    success: function(res) {
                        chulpan_grid1.getStore().reload();
                        Ext.Msg.alert('알림', '삭제가 완료되었습니다.');
                    },
                    failuer: function() {
                        Ext.Msg.alert('오류', '삭제 중 오류가 발생했습니다.');
                    }

                });

            }
        });






    },

    onButtonClick_chulpan_delete_button2: function(button, e, eOpts) {

    },

    onButtonClick_chulpan_insert_button: function(button, e, eOpts) {
        const list_grid = this.lookupReference('list_grid');
        const chulpan_grid1 = this.lookupReference('chulpan_grid1');

        if (list_grid.getSelection().length === 0) {
            Ext.Msg.alert('알림', '서점을 선택해주세요.');
            return;
        }

        const chulpan_code = this.lookupReference('chulpan_code').getValue();

        if (Ext.isEmpty(chulpan_code)) {
            Ext.Msg.alert('알림', '등록할 출판사를 검색해주세요.');
            return;
        }

        Ext.Msg.confirm('확인', '등록하시겠습니까?', function(btn) {
            if (btn === 'yes') {
                const sujum_code = list_grid.getSelection()[0].get('sujumCd');

                Ext.Ajax.request({
                    url: dream.util.Common.BASE_URL + '/tbas/1010/chulpan-insert',
                    method: 'POST',
                    jsonData: {
                        insertId: dream.util.Common.LOGIN_USER,
                        userCetCd: dream.util.Common.LOGIN_USER_CET_CD,
                        sujumCd: sujum_code,
                        chulpanCd: chulpan_code
                    },
                    success: function(res) {
                        chulpan_grid1.getStore().reload();
                        Ext.Msg.alert('알림', '등록이 완료되었습니다.');
                    },
                    failure: function() {
                        Ext.Msg.alert('오류', '등록 중 오류가 발생했습니다.');
                    }

                });
            }
        });

    },

    onButtonClick_chulpan_insert_button2: function(button, e, eOpts) {
        const list_grid = this.lookupReference('list_grid');
        const chulpan_grid1 = this.lookupReference('chulpan_grid2');

        if (list_grid.getSelection().length === 0) {
            Ext.Msg.alert('알림', '서점을 선택해주세요.');
            return;
        }

        const chulpan_code = this.lookupReference('chulpan_code2').getValue();

        if (Ext.isEmpty(chulpan_code)) {
            Ext.Msg.alert('알림', '등록할 출판사를 검색해주세요.');
            return;
        }

        Ext.Msg.confirm('확인', '등록하시겠습니까?', function(btn) {
            if (btn === 'yes') {
                const sujum_code = list_grid.getSelection()[0].get('sujumCd');

                Ext.Ajax.request({
                    url: dream.util.Common.BASE_URL + '/tbas/1010/chulpan-insert2',
                    method: 'POST',
                    jsonData: {
                        insertId: dream.util.Common.LOGIN_USER,
                        userCetCd: dream.util.Common.LOGIN_USER_CET_CD,
                        sujumCd: sujum_code,
                        chulpanCd: chulpan_code
                    },
                    success: function(res) {
                        chulpan_grid1.getStore().reload();
                        Ext.Msg.alert('알림', '등록이 완료되었습니다.');
                    },
                    failure: function() {
                        Ext.Msg.alert('오류', '등록 중 오류가 발생했습니다.');
                    }

                });
            }
        });

    },

    onGridpanelAfterRender_list_grid: function(component, eOpts) {
        const store = component.getStore();

        // 1. proxy의 URL을 동적으로 설정
        store.getProxy().setUrl(dream.util.Common.BASE_URL+'/tbas/1010/list');

        // 2. 필요 시 추가 파라미터 설정 (예: userCetCd 등)
        store.getProxy().setExtraParams({
            userCetCd: dream.util.Common.LOGIN_USER_CET_CD
        });

        // 3. 스토어 리로드
        store.reload();
    },

    onGridpanelSelectionChange_list_grid: function(model, selected, eOpts) {
        if (selected.length === 0) return;


        const name = this.lookupReference('sujum_name');
        const code = this.lookupReference('sujum_code');
        const jiyuk = this.lookupReference('sujum_jiyuk');
        const bigo = this.lookupReference('sujum_bigo');
        const cond = this.lookupReference('sujum_cond');
        const qty = this.lookupReference('sujum_qty');
        const price = this.lookupReference('sujum_price');
        const cond_val = selected[0].get('dochakBasicGb');
        const dochak_gb = this.lookupReference('dochak_gb');

        name.setValue(selected[0].get('custNm'));
        code.setValue(selected[0].get('sujumCd'));
        jiyuk.setValue(selected[0].get('jiyukNm'));
        bigo.setValue(selected[0].get('dochakBigo'));
        qty.setValue(selected[0].get('dochakOverQty'));
        price.setValue(selected[0].get('dochakBasicDanga'));
        dochak_gb.setValue(selected[0].get('dochakGb'));

        cond.setValue({ dochakBasicGb: cond_val });

        if (qty) {
            qty.setFieldLabel(cond_val === '0' ? '부수' : '덩이');
        }


        // chulpan_grid1 리스트 표기
        const grid1 = this.lookupReference('chulpan_grid1');
        const grid1_store = grid1.getStore();

        grid1_store.getProxy().setExtraParams({
            userCetCd: dream.util.Common.LOGIN_USER_CET_CD,
            chulpanGb: '1',
            sujumCd: selected[0].get('sujumCd')
        });

        grid1_store.load();


        // chulpan_grid2 리스트 표기
        const grid2 = this.lookupReference('chulpan_grid2');
        const grid2_store = grid2.getStore();

        grid2_store.getProxy().setExtraParams({
            userCetCd: dream.util.Common.LOGIN_USER_CET_CD,
            chulpanGb: '2',
            sujumCd: selected[0].get('sujumCd')
        });

        grid2_store.load();


    },

    onGridpanelAfterRender_chulpan_grid1: function(component, eOpts) {
        const store = component.getStore();

        // 1. proxy의 URL을 동적으로 설정
        store.getProxy().setUrl(dream.util.Common.BASE_URL+'/tbas/1010/chulpan-list');

        // 2. 필요 시 추가 파라미터 설정 (예: userCetCd 등)
        store.getProxy().setExtraParams({
            userCetCd: dream.util.Common.LOGIN_USER_CET_CD,
            chulpanGb: '1'
        });

        // 3. 스토어 리로드
        // store.reload();
    },

    onGridpanelAfterRender_chulpan_grid2: function(component, eOpts) {
        const store = component.getStore();

        // 1. proxy의 URL을 동적으로 설정
        store.getProxy().setUrl(dream.util.Common.BASE_URL+'/tbas/1010/chulpan-list');

        // 2. 필요 시 추가 파라미터 설정 (예: userCetCd 등)
        store.getProxy().setExtraParams({
            userCetCd: dream.util.Common.LOGIN_USER_CET_CD,
            chulpanGb: '2'
        });

        // 3. 스토어 리로드
        // store.reload();
    }

});
