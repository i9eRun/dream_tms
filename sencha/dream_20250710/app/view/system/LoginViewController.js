/*
 * File: app/view/system/LoginViewController.js
 *
 * This file was generated by Sencha Architect version 4.3.7.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 7.9.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 7.9.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('dream.view.system.LoginViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.system.login',

    onLoginButtonClick: function(button, e, eOpts) {
        const form = this.lookupReference('login_form');
        const values = form.getValues();
        const user_id = values.userid;
        const user_pw = values.password;

        // console.log(dream.util.Common.BASE_URL);

        // const loginWindow = button.up('window') || button.up('viewport');
        // loginWindow.destroy();
        // Ext.create('dream.view.system.MainFrame');



        if (!user_id || !user_pw) {
            //Ext.Msg.alert('경고', '아이디와 비밀번호를 모두 입력해주세요.');
            //return;
            dream.util.Common.LOGIN_USER = '20250304';
            dream.util.Common.LOGIN_USER_NAME = '조용우';
            dream.util.Common.LOGIN_USER_CET_CD = '00001';

            const loginWindow = button.up('window') || button.up('viewport');

            loginWindow.destroy();
            Ext.create('dream.view.system.MainFrame');
        }

        return;

        // 로그인 실행 로직
        Ext.Ajax.request({
            url: dream.util.Common.BASE_URL+'/system/login',
            method: 'POST',
            withCredentials: true,
            jsonData: {
                userid: user_id,
                password: user_pw
            },
            success: function (response) {
                const res = Ext.decode(response.responseText);
                if (res.success) {
                    Ext.Msg.alert('성공', res.userName + '님 환영합니다!');

                    dream.util.Common.LOGIN_USER = user_id;
                    dream.util.Common.LOGIN_USER_NAME = res.userName;
                    dream.util.Common.LOGIN_USER_CET_CD = res.userCetCd;

                    const loginWindow = button.up('window') || button.up('viewport');

                    loginWindow.destroy();
                    Ext.create('dream.view.system.MainFrame');


                } else {
                    Ext.Msg.alert('오류', res.message);
                }
            },
            failure: function () {
                Ext.Msg.alert('오류', '서버와 통신 중 오류가 발생했습니다.');
            }
        });




    }

});
