/*
 * File: app/view/tsys/tsys1005ViewController.js
 *
 * This file was generated by Sencha Architect version 4.3.7.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 7.9.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 7.9.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('dream.view.tsys.tsys1005ViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.tsys.tsys1005',

    onGridpanelAfterRender_tsys1005_codegroupgrid: function(component, eOpts) {
        const store = component.getStore();

        // 1. proxyì˜ URLì„ ë™ì ìœ¼ë¡œ ì„¤ì •
        store.getProxy().setUrl(dream.util.Common.BASE_URL+'/tsys/code/grouplist');

        // 2. í•„ìš” ì‹œ ì¶”ê°€ íŒŒë¼ë¯¸í„° ì„¤ì • (ì˜ˆ: userCetCd ë“±)
        store.getProxy().setExtraParams({
            userCetCd: dream.util.Common.LOGIN_USER_CET_CD
        });


        // 3. ìŠ¤í† ì–´ ë¦¬ë¡œë“œ
        store.reload();





        // Ext.Ajax.request({
        //     url: dream.util.Common.BASE_URL+'/tsys/code/grouplist',
        //     method: 'POST',

        //     jsonData: {
        //         userCetCd: dream.util.Common.LOGIN_USER_CET_CD
        //     },
        //     success: function(response) {
        //         const json = Ext.decode(response.responseText);
        //         store.setData(json);
        //     },
        //     failure: function(response) {
        //         Ext.Msg.alert('ì—ëŸ¬', 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        //     }
        // });
    },

    onGridpanelItemClick_tsys1005_codeGroupGrid: function(dataview, record, item, index, e, eOpts) {
        // const view = this.getView();
        // const form = this.lookupReference('tsys1005_code_group_form');
        // const form2 = this.lookupReference('tsys1005_code_detail_form');
        // if (form) {
        //     form.loadRecord(record);  // ë ˆì½”ë“œë¥¼ í¼ì— ë¡œë”©
        // }

        // if (form2) form2.reset();


        // const codeCd = record.data.codeCd;
        // view.selectedGroup = codeCd;

        // const grid = view.lookupReference('codeListGrid');
        // const store = grid.getStore();

        // Ext.Ajax.request({
        //     url: dream.util.Common.BASE_URL+'/tsys/code/list/'+codeCd,
        //     method: 'GET',

        //     success: function(response) {
        //         const json = Ext.decode(response.responseText);
        //         store.setData(json);
        //     },
        //     failure: function(response) {
        //         Ext.Msg.alert('ì—ëŸ¬', 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        //     }
        // });

    },

    onGridpanelSelectionChange_tsys1005_codegroupgrid: function(model, selected, eOpts) {
        if (!selected || selected.length === 0) {
            console.warn('ì„ íƒëœ ë ˆì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }

        const view = this.getView();
        const form = this.lookupReference('tsys1005_code_group_form');
        const form2 = this.lookupReference('tsys1005_code_detail_form');
        const code_cd_field = form.down('[name=codeCd]');

        if (form) {
            form.loadRecord(selected[0]);  // ë ˆì½”ë“œë¥¼ í¼ì— ë¡œë”©
            code_cd_field.setReadOnly(true);

        }

        if (form2) form2.reset();


        const codeCd = selected[0].data.codeCd;
        view.selectedGroup = codeCd;

        const grid = view.lookupReference('codeListGrid');
        const store = grid.getStore();

        Ext.Ajax.request({
            url: dream.util.Common.BASE_URL+'/tsys/code/list/'+codeCd,
            method: 'GET',

            success: function(response) {
                const json = Ext.decode(response.responseText);
                store.setData(json);
            },
            failure: function(response) {
                Ext.Msg.alert('ì—ëŸ¬', 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });
    },

    onGridpanelItemClick_tsys1005_code_list_gird: function(dataview, record, item, index, e, eOpts) {
        //         const form = this.lookupReference('tsys1005_code_detail_form');
        //         if (form) {
        //             form.loadRecord(record);  // ë ˆì½”ë“œë¥¼ í¼ì— ë¡œë”©
        //         }
    },

    onGridpanelSelectionChange_tsys1005_codelistgrid: function(model, selected, eOpts) {
        if (!selected || selected.length === 0) {
            console.warn('ì„ íƒëœ ë ˆì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }

        const form = this.lookupReference('tsys1005_code_detail_form');
        let record = selected[0];

        if (form) {
            form.loadRecord(record);  // ë ˆì½”ë“œë¥¼ í¼ì— ë¡œë”©
        }
    },

    onTsys1005_group_insertClick: function(button, e, eOpts) {
        const view = this.getView();
        const form = view.lookupReference('tsys1005_code_group_form');
        if (form) {
            form.reset();

            // useYn í•„ë“œ ê°’ ì„¤ì •
            const useYnField = form.down('[name=useYn]');
            if (useYnField) {
                useYnField.setValue('1');
            }

            // codeCd í•„ë“œì— í¬ì»¤ìŠ¤ ì£¼ê¸° (reset ì´í›„ì— í˜¸ì¶œí•´ì•¼ í•¨)
            const codeCdField = form.down('[name=codeCd]');
            if (codeCdField) {
                codeCdField.setReadOnly(false);
                codeCdField.focus(true, 200); // delay 200ms (ì„ íƒì‚¬í•­)
            }
        }

    },

    onTsys1005_group_saveClick: function(button, e, eOpts) {
        // const view = this.getView();
        // const form = view.lookupReference('tsys1005_code_group_form');
        // const grid = view.lookupReference('codeGroupGrid');

        // const values = form.getValues();
        // values.insertId = dream.util.Common.LOGIN_USER_ID;
        // values.userCetCd = dream.util.Common.LOGIN_USER_CET_CD;

        // Ext.Ajax.request({
        //     url: dream.util.Common.BASE_URL + '/tsys/code/groupinsert',
        //     method: 'POST',
        //     jsonData: values,
        //     success: function () {
        //         Ext.Msg.alert('ì„±ê³µ', 'ê·¸ë£¹ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');

        //         grid.getStore().reload();
        //     },
        //     failure: function () {
        //         Ext.Msg.alert('ì‹¤íŒ¨', 'ê·¸ë£¹ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        //     }
        // });

        const view = this.getView();
        const form = view.lookupReference('tsys1005_code_group_form');
        const grid = view.lookupReference('codeGroupGrid');

        const values = form.getValues();
        values.insertId = dream.util.Common.LOGIN_USER_ID;
        values.userCetCd = dream.util.Common.LOGIN_USER_CET_CD;

        // ğŸ”¹ í™•ì¸ì°½ ì¶”ê°€
        Ext.Msg.confirm('í™•ì¸', 'ê·¸ë£¹ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function(btn) {
            if (btn === 'yes') {
                Ext.Ajax.request({
                    url: dream.util.Common.BASE_URL + '/tsys/code/groupinsert',
                    method: 'POST',
                    jsonData: values,
                    success: function () {
                        Ext.Msg.alert('ì„±ê³µ', 'ê·¸ë£¹ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        grid.getStore().reload();
                    },
                    failure: function () {
                        Ext.Msg.alert('ì‹¤íŒ¨', 'ê·¸ë£¹ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                });
            }
        });
    },

    onButtonClick_tsys1005_group_keyword: function(button, e, eOpts) {
        const view = this.getView();
        const grid = view.lookupReference('codeGroupGrid');
        const store = grid.getStore();
        const keywordField = Ext.getCmp('tsys1005_group_keyword');
        const keyword = keywordField ? keywordField.getValue() : '';

        store.getProxy().setExtraParams({
            userCetCd: dream.util.Common.LOGIN_USER_CET_CD,
            groupKeyword: keyword
        });


        store.reload();

    },

    onTsys1005_group_deleteClick: function(button, e, eOpts) {
        const view = this.getView();
        const grid = this.lookupReference('codeGroupGrid');
        const record = grid.getSelectionModel().getSelection()[0];
        const form = view.lookupReference('tsys1005_code_group_form');

        if (!record) {
            Ext.Msg.alert('ì•Œë¦¼', 'ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.');
            return;
        }

        Ext.Msg.confirm('í™•ì¸', 'ì„ íƒí•œ ê·¸ë£¹ì½”ë“œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function (btn) {
            if (btn === 'yes') {
                Ext.Ajax.request({
                    url: dream.util.Common.BASE_URL + '/tsys/code/groupdelete',
                    method: 'DELETE',
                    jsonData: {
                        userCetCd: dream.util.Common.LOGIN_USER_CET_CD,
                        groupCd: record.get('groupCd'),
                        codeCd: record.get('codeCd')
                    },
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    success: function (response) {
                        Ext.Msg.alert('ì„±ê³µ', 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        grid.getStore().reload();

                        if (form) {
                            form.reset();
                        }

                    },
                    failure: function (response) {
                        Ext.Msg.alert('ì˜¤ë¥˜', 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                });
            }
        });
    },

    onTsys1005_code_deleteClick: function(button, e, eOpts) {
        const view = this.getView();
        const grid = view.lookupReference('codeListGrid');
        const store = grid.getStore();
        const form = view.lookupReference('tsys1005_code_detail_form');
        const record = grid.getSelection()[0];

        if (!record) {
            Ext.Msg.alert('ì•Œë¦¼', 'ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.');
            return;
        }


        Ext.Msg.confirm('í™•ì¸', 'ì„ íƒí•œ ì½”ë“œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function(btn) {
            if (btn === 'yes') {
                Ext.Ajax.request({
                    url: dream.util.Common.BASE_URL + '/tsys/code/codedelete',
                    method: 'POST',
                    jsonData: {
                        groupCd: record.get('groupCd'),
                        codeCd: record.get('codeCd'),
                        userCetCd: dream.util.Common.LOGIN_USER_CET_CD
                    },
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    success: function(response) {
                        Ext.Msg.alert('ì„±ê³µ', 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        if (grid) {
                            store.getProxy().setUrl(dream.util.Common.BASE_URL+'/tsys/code/list/'+view.selectedGroup);
                            store.reload();
                        }
                        form.reset();
                    },
                    failure: function(response) {
                        Ext.Msg.alert('ì‹¤íŒ¨', 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                });
            }
        });

    },

    onTsys1005_code_insertClick: function(button, e, eOpts) {
        const view = this.getView();
        const form = view.lookupReference('tsys1005_code_detail_form');
        if (form) {
            form.reset();

            // useYn í•„ë“œ ê°’ ì„¤ì •
            const useYnField = form.down('[name=useYn]');
            if (useYnField) {
                useYnField.setValue('1');
            }

            // codeCd í•„ë“œì— í¬ì»¤ìŠ¤ ì£¼ê¸° (reset ì´í›„ì— í˜¸ì¶œí•´ì•¼ í•¨)
            const codeCdField = form.down('[name=codeCd]');
            if (codeCdField) {
                codeCdField.focus(true, 200); // delay 200ms (ì„ íƒì‚¬í•­)
            }
        }
    },

    onTsys1005_code_saveClick: function(button, e, eOpts) {
        // const view = this.getView();
        // const form = view.lookupReference('tsys1005_code_detail_form');
        // const grid = view.lookupReference('codeListGrid');
        // const store = grid.getStore();

        // const values = form.getValues();
        // values.insertId = dream.util.Common.LOGIN_USER;
        // values.userCetCd = dream.util.Common.LOGIN_USER_CET_CD;
        // values.groupCd = view.selectedGroup;

        // Ext.Ajax.request({
        //     url: dream.util.Common.BASE_URL + '/tsys/code/codeinsert',
        //     method: 'POST',
        //     headers: {
        //         'Content-Type': 'application/json'
        //     },
        //     jsonData: values,
        //     success: function (res) {
        //         Ext.Msg.alert('ì„±ê³µ', 'ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');

        //         if (grid) {
        //             store.getProxy().setUrl(dream.util.Common.BASE_URL+'/tsys/code/list/'+view.selectedGroup);
        //             store.reload();
        //         }
        //     },
        //     failure: function (res) {
        //         Ext.Msg.alert('ì‹¤íŒ¨', 'ë“±ë¡ ì‹¤íŒ¨: ' + res.responseText);
        //     }
        // });



        const view = this.getView();
        const form = view.lookupReference('tsys1005_code_detail_form');
        const grid = view.lookupReference('codeListGrid');
        const store = grid.getStore();

        const values = form.getValues();
        values.insertId = dream.util.Common.LOGIN_USER;
        values.userCetCd = dream.util.Common.LOGIN_USER_CET_CD;
        values.groupCd = view.selectedGroup;

        // í™•ì¸ì°½ ì¶”ê°€
        Ext.Msg.confirm('í™•ì¸', 'ì½”ë“œë¥¼ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function(btn) {
            if (btn === 'yes') {
                Ext.Ajax.request({
                    url: dream.util.Common.BASE_URL + '/tsys/code/codeinsert',
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    jsonData: values,
                    success: function (res) {
                        Ext.Msg.alert('ì„±ê³µ', 'ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');

                        if (grid) {
                            store.getProxy().setUrl(
                            dream.util.Common.BASE_URL + '/tsys/code/list/' + view.selectedGroup
                            );
                            store.reload();
                        }
                    },
                    failure: function (res) {
                        Ext.Msg.alert('ì‹¤íŒ¨', 'ë“±ë¡ ì‹¤íŒ¨: ' + res.responseText);
                    }
                });
            }
        });


    },

    onTsys1005_group_keywordAfterRender: function(component, eOpts) {
        const button = this.lookupReference('search_button');

        component.on('specialkey', function(component, e) {
            if (e.getKey() === e.ENTER) {
                if (button) {
                    button.fireEvent('click', button);
                }
            }
        });
    },

    onComboboxAfterRender_tsys1005_group_useyn: function(component, eOpts) {
        dream.util.Common.setFlagCombo(component,"ì‚¬ìš©","","1");
    },

    onComboboxAfterRender_codelistform_useyn: function(component, eOpts) {
        dream.util.Common.setFlagCombo(component,"ì‚¬ìš©","","1");
    },

    onTsys1005_group_updateClick: function(button, e, eOpts) {
        // const view = this.getView();
        // const form = view.lookupReference('tsys1005_code_group_form');
        // const grid = view.lookupReference('codeGroupGrid');
        // const values = form.getValues();
        // const codecd_field = form.down('[name=codeCd]');

        // values.updateId = dream.util.Common.LOGIN_USER;
        // values.userCetCd = dream.util.Common.LOGIN_USER_CET_CD;

        // Ext.Ajax.request({
        //     url: dream.util.Common.BASE_URL + '/tsys/code/groupupdate',
        //     method: 'POST',
        //     jsonData: values,
        //     success: function () {
        //         Ext.Msg.alert('ì„±ê³µ', 'ê·¸ë£¹ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');

        //         grid.getStore().reload();
        //     },
        //     failure: function () {
        //         Ext.Msg.alert('ì‹¤íŒ¨', 'ê·¸ë£¹ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        //     }
        // });



        const view = this.getView();
        const form = view.lookupReference('tsys1005_code_group_form');
        const grid = view.lookupReference('codeGroupGrid');
        const values = form.getValues();
        const codecd_field = form.down('[name=codeCd]');

        values.updateId = dream.util.Common.LOGIN_USER;
        values.userCetCd = dream.util.Common.LOGIN_USER_CET_CD;

        // ğŸ”¹ í™•ì¸ì°½ ì¶”ê°€
        Ext.Msg.confirm('í™•ì¸', 'ì„ íƒí•œ ê·¸ë£¹ì„ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function(btn) {
            if (btn === 'yes') {
                Ext.Ajax.request({
                    url: dream.util.Common.BASE_URL + '/tsys/code/groupupdate',
                    method: 'POST',
                    jsonData: values,
                    success: function () {
                        Ext.Msg.alert('ì„±ê³µ', 'ê·¸ë£¹ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        grid.getStore().reload();
                    },
                    failure: function () {
                        Ext.Msg.alert('ì‹¤íŒ¨', 'ê·¸ë£¹ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                });
            }
        });


    },

    onTsys1005_code_updateClick: function(button, e, eOpts) {
        // const view = this.getView();
        // const form = view.lookupReference('tsys1005_code_detail_form');
        // const grid = view.lookupReference('codeListGrid');
        // const store = grid.getStore();

        // const values = form.getValues();
        // values.updateId = dream.util.Common.LOGIN_USER;
        // values.userCetCd = dream.util.Common.LOGIN_USER_CET_CD;
        // values.groupCd = view.selectedGroup;

        // Ext.Ajax.request({
        //     url: dream.util.Common.BASE_URL + '/tsys/code/codeupdate',
        //     method: 'POST',
        //     headers: {
        //         'Content-Type': 'application/json'
        //     },
        //     jsonData: values,
        //     success: function (res) {
        //         Ext.Msg.alert('ì„±ê³µ', 'ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');

        //         if (grid) {
        //             store.getProxy().setUrl(dream.util.Common.BASE_URL+'/tsys/code/list/'+view.selectedGroup);
        //             store.reload();
        //         }
        //     },
        //     failure: function (res) {
        //         Ext.Msg.alert('ì‹¤íŒ¨', 'ìˆ˜ì • ì‹¤íŒ¨: ' + res.responseText);
        //     }
        // });


        const view = this.getView();
        const form = view.lookupReference('tsys1005_code_detail_form');
        const grid = view.lookupReference('codeListGrid');
        const store = grid.getStore();

        const values = form.getValues();
        values.updateId = dream.util.Common.LOGIN_USER;
        values.userCetCd = dream.util.Common.LOGIN_USER_CET_CD;
        values.groupCd = view.selectedGroup;

        // í™•ì¸ì°½ ì¶”ê°€
        Ext.Msg.confirm('í™•ì¸', 'ì„ íƒí•œ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function(btn) {
            if (btn === 'yes') {
                Ext.Ajax.request({
                    url: dream.util.Common.BASE_URL + '/tsys/code/codeupdate',
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    jsonData: values,
                    success: function (res) {
                        Ext.Msg.alert('ì„±ê³µ', 'ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');

                        if (grid) {
                            store.getProxy().setUrl(
                            dream.util.Common.BASE_URL + '/tsys/code/list/' + view.selectedGroup
                            );
                            store.reload();
                        }
                    },
                    failure: function (res) {
                        Ext.Msg.alert('ì‹¤íŒ¨', 'ìˆ˜ì • ì‹¤íŒ¨: ' + res.responseText);
                    }
                });
            }
        });


    }

});
