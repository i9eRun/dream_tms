/*
 * File: app/view/LoginViewViewController.js
 *
 * This file was generated by Sencha Architect version 4.3.7.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 7.9.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 7.9.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('TmsLabel.view.LoginViewViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.loginview',

    onTextfieldAfterRender_password: function(component, eOpts) {
        const button = this.lookupReference('login_button');
        component.on('specialkey', function(component, e) {
            if (e.getKey() === e.ENTER) {
                if (button) {
                    button.fireEvent('click', button);
                }
            }
        });
    },

    onButtonClick_login_button: function(button, e, eOpts) {
        const form = this.lookupReference('login_form');
        const values = form.getValues();
        const user_id = values.userId;
        const user_pw = values.password;

        if (Ext.isEmpty(user_id) || Ext.isEmpty(user_pw) ) {
            Ext.Msg.alert('알림', '아이디 와 비밀번호를 입력해주세요.');
            return;
        }


        Ext.Ajax.request({
            url: TmsLabel.util.Common.BASE_URL + '/tmslabel/login',
            method: 'POST',
            withCredentials: true,
            jsonData: {
                userId: user_id,
                password: user_pw
            },
            success: function (response) {
                const res = Ext.decode(response.responseText);
                if (res.success) {
                    Ext.Msg.alert('로그인 성공', res.custName + '님 환영합니다.');
                    TmsLabel.util.Common.LOGIN_USER = user_id;
                    TmsLabel.util.Common.LOGIN_CUST_NAME = res.custName;
                    TmsLabel.util.Common.LOGIN_CUST_CD = res.custCode;
                    TmsLabel.util.Common.LOGIN_CUST_DIV_GB = res.custDivGb;
                    TmsLabel.util.Common.LOGIN_USER_CET_CD = res.userCetCd;

                    const loginWindow = button.up('window') || button.up('viewport');

                    loginWindow.destroy();
                    Ext.create('TmsLabel.view.MainView');
                } else {
                    Ext.Msg.alert('로그인 오류', res.message);
                }
            },
            failure: function () {
                Ext.Msg.alert('오류', '서버와 통신 중 오류가 발생했습니다.');
            }
        });




        // TmsLabel.util.Common.LOGIN_USER = '20250304';
        // TmsLabel.util.Common.LOGIN_USER_NAME = '테스트 출판사';
        // TmsLabel.util.Common.LOGIN_USER_CET_CD = '00001';
        // TmsLabel.util.Common.LOGIN_CUST_DIV_GB = '1';

        // const loginWindow = button.up('window') || button.up('viewport');

        // loginWindow.destroy();
        // Ext.create('TmsLabel.view.MainView');


    }

});
